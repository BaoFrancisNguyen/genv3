{% extends "base.html" %}

{% block title %}G√©n√©rateur Malaysia - Accueil{% endblock %}
{% block nav_home %}active{% endblock %}

{% block content %}
<!-- Section de s√©lection de zone -->
<section class="zone-selection">
    <h2>üìç S√©lection de Zone Malaysia</h2>
    
    <div class="form-group">
        <label for="zone-select">Zone √† analyser :</label>
        <select id="zone-select" class="form-control">
            <option value="">-- S√©lectionnez une zone --</option>
            {% for zone in zones %}
            <option value="{{ zone.zone_id }}" 
                    data-buildings="{{ zone.estimated_buildings }}"
                    data-complexity="{{ zone.complexity_level }}"
                    data-recommended="{{ zone.recommended }}">
                {{ zone.name }} ({{ zone.state }}) - {{ zone.estimated_buildings }} b√¢timents
            </option>
            {% endfor %}
        </select>
    </div>
    
    <!-- Informations sur la zone s√©lectionn√©e -->
    <div id="zone-info" class="zone-info hidden">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Estimation:</span>
                <span id="zone-buildings">-</span> b√¢timents
            </div>
            <div class="info-item">
                <span class="info-label">Temps estim√©:</span>
                <span id="zone-time">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">Taille:</span>
                <span id="zone-size">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">Complexit√©:</span>
                <span id="zone-complexity">-</span>
            </div>
        </div>
        
        <div id="zone-warnings" class="warnings hidden">
            <!-- Les avertissements appara√Ætront ici -->
        </div>
        
        <button id="load-osm-btn" class="btn btn-primary" disabled>
            üîÑ Charger les B√¢timents OSM
        </button>
    </div>
</section>

<!-- Section des b√¢timents OSM -->
<section class="osm-buildings hidden" id="osm-section">
    <h2>üèóÔ∏è B√¢timents OpenStreetMap</h2>
    
    <div class="osm-status">
        <div class="status-item">
            <span class="status-label">B√¢timents charg√©s:</span>
            <span id="buildings-count">0</span>
        </div>
        <div class="status-item">
            <span class="status-label">Types d√©tect√©s:</span>
            <span id="building-types">-</span>
        </div>
        <div class="status-item">
            <span class="status-label">Qualit√©:</span>
            <span id="data-quality">-</span>
        </div>
    </div>
    
    <!-- R√©partition par types -->
    <div id="building-distribution" class="building-distribution">
        <!-- Graphique de r√©partition sera ins√©r√© ici -->
    </div>
    
    <!-- Carte simple (optionnelle) -->
    <div id="buildings-map" class="buildings-map hidden">
        <div class="map-placeholder">
            üìç <span id="map-center">Carte des b√¢timents</span>
        </div>
    </div>
</section>

<!-- Section de g√©n√©ration -->
<section class="generation-config hidden" id="generation-section">
    <h2>‚ö° Configuration de G√©n√©ration</h2>
    
    <form id="generation-form" class="generation-form">
        <div class="form-row">
            <div class="form-group">
                <label for="start-date">Date de d√©but :</label>
                <input type="date" id="start-date" name="start_date" 
                       value="2024-01-01" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="end-date">Date de fin :</label>
                <input type="date" id="end-date" name="end_date" 
                       value="2024-01-31" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="frequency">Fr√©quence :</label>
                <select id="frequency" name="frequency" class="form-control">
                    <option value="30T">30 minutes (recommand√©)</option>
                    <option value="1H">1 heure</option>
                    <option value="15T">15 minutes</option>
                    <option value="3H">3 heures</option>
                    <option value="D">Quotidien</option>
                </select>
            </div>
        </div>
        
        <!-- Estimation de g√©n√©ration -->
        <div id="generation-estimate" class="estimate-box">
            <h3>üìä Estimation de G√©n√©ration</h3>
            <div class="estimate-grid">
                <div class="estimate-item">
                    <span class="estimate-label">Observations:</span>
                    <span id="estimate-observations">-</span>
                </div>
                <div class="estimate-item">
                    <span class="estimate-label">Temps estim√©:</span>
                    <span id="estimate-time">-</span>
                </div>
                <div class="estimate-item">
                    <span class="estimate-label">Taille donn√©es:</span>
                    <span id="estimate-size">-</span>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="button" id="estimate-btn" class="btn btn-secondary">
                üìä Estimer
            </button>
            
            <button type="submit" id="generate-btn" class="btn btn-success" disabled>
                ‚ö° G√©n√©rer les Donn√©es
            </button>
        </div>
    </form>
</section>

<!-- Section de r√©sultats -->
<section class="results hidden" id="results-section">
    <h2>üìä R√©sultats de G√©n√©ration</h2>
    
    <!-- Statistiques -->
    <div class="results-stats">
        <div class="stat-card">
            <div class="stat-number" id="result-buildings">-</div>
            <div class="stat-label">B√¢timents</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number" id="result-observations">-</div>
            <div class="stat-label">Observations</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number" id="result-quality">-</div>
            <div class="stat-label">Qualit√©</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number" id="result-duration">-</div>
            <div class="stat-label">Dur√©e</div>
        </div>
    </div>
    
    <!-- Aper√ßu des donn√©es -->
    <div class="data-preview">
        <h3>üëÅÔ∏è Aper√ßu des Donn√©es</h3>
        
        <!-- Onglets de pr√©visualisation -->
        <div class="preview-tabs">
            <button class="tab-btn active" data-tab="buildings">B√¢timents</button>
            <button class="tab-btn" data-tab="timeseries">S√©ries Temporelles</button>
            <button class="tab-btn" data-tab="summary">R√©sum√©</button>
        </div>
        
        <!-- Contenu des onglets -->
        <div class="tab-content">
            <div id="tab-buildings" class="tab-pane active">
                <div id="buildings-preview" class="data-table">
                    <!-- Aper√ßu des m√©tadonn√©es de b√¢timents -->
                </div>
            </div>
            
            <div id="tab-timeseries" class="tab-pane">
                <div id="timeseries-preview" class="data-table">
                    <!-- Aper√ßu des s√©ries temporelles -->
                </div>
            </div>
            
            <div id="tab-summary" class="tab-pane">
                <div id="summary-content" class="summary-content">
                    <!-- R√©sum√© statistique -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Section d'export -->
<section class="export-options hidden" id="export-section">
    <h2>üíæ Export des Donn√©es</h2>
    
    <form id="export-form" class="export-form">
        <div class="export-formats">
            <h3>Formats d'export :</h3>
            
            <div class="format-options">
                <label class="format-option">
                    <input type="checkbox" name="formats" value="csv" checked>
                    <span class="format-label">
                        üìÑ CSV
                        <small>Compatible Excel, Python, R</small>
                    </span>
                </label>
                
                <label class="format-option">
                    <input type="checkbox" name="formats" value="parquet" checked>
                    <span class="format-label">
                        üóúÔ∏è Parquet
                        <small>Optimis√© big data, compression</small>
                    </span>
                </label>
                
                <label class="format-option">
                    <input type="checkbox" name="formats" value="xlsx">
                    <span class="format-label">
                        üìä Excel
                        <small>Onglets multiples, compatible Office</small>
                    </span>
                </label>
                
                <label class="format-option">
                    <input type="checkbox" name="formats" value="json">
                    <span class="format-label">
                        üîó JSON
                        <small>APIs web, applications JavaScript</small>
                    </span>
                </label>
            </div>
        </div>
        
        <div class="export-actions">
            <button type="submit" id="export-btn" class="btn btn-primary">
                üíæ Exporter les Donn√©es
            </button>
        </div>
    </form>
    
    <!-- Zone de t√©l√©chargement -->
    <div id="download-section" class="download-section hidden">
        <h3>üìÅ Fichiers G√©n√©r√©s</h3>
        <div id="download-links" class="download-links">
            <!-- Les liens de t√©l√©chargement appara√Ætront ici -->
        </div>
    </div>
</section>

<!-- Progress global -->
<div id="global-progress" class="progress-overlay hidden">
    <div class="progress-content">
        <div class="progress-title">Traitement en cours...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">Initialisation...</div>
        <button id="cancel-btn" class="btn btn-danger">Annuler</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/osm_map.js') }}"></script>
<script>
    // Initialisation de l'application
    document.addEventListener('DOMContentLoaded', function() {
        // Configuration globale
        window.APP_CONFIG = {
            apiBaseUrl: '/api',
            maxBuildings: 10000,
            defaultFrequency: '30T'
        };
        
        // Initialisation des composants
        initializeZoneSelector();
        initializeGenerationForm();
        initializeExportForm();
        
        console.log('‚úÖ Application Malaysia Electricity Generator initialis√©e');
    });
</script>
{% endblock %}
